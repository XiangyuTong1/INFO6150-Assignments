<!doctype html>
<html lang="en">
<head>
    <title>Feedback</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        label {
            float: left;
            width: 150px;
            font-weight: bold;
        }

        #container {
            width: 700px;
            margin: auto;
            background-color: beige;
            position: relative;
        }

        main {
            padding: 50px;
        }

        .form-group {
            margin-bottom: 15px;
            clear: both;
            overflow: hidden;
        }

        .error-message {
            color: red;
            font-size: 12px;
            margin-left: 150px;
            display: none;
        }

        input[type="text"], textarea, select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        input[type="text"]:invalid, textarea:invalid {
            border-color: red;
        }

        input[type="submit"], input[type="reset"] {
            padding: 8px 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        #submitBtn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .char-counter {
            margin-left: 150px;
            font-size: 12px;
            color: #666;
        }

        #resultsTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
        }

        #resultsTable th, #resultsTable td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }

        #resultsTable th {
            background-color: #333;
            color: white;
        }

        .dynamic-checkbox-container {
            margin-left: 150px;
            margin-top: 10px;
        }

        .dynamic-textfield {
            margin-left: 150px;
            margin-top: 5px;
        }

        /* AI Assistant Styles */
        #aiAssistantBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        #aiAssistantBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }

        #chatWindow {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            flex-direction: column;
            z-index: 1001;
        }

        #chatHeader {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        #chatMessages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .bot-message {
            background: #e3f2fd;
            margin-right: auto;
        }

        .user-message {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        #chatInputContainer {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
        }

        #chatInput {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 5px;
        }

        #chatSendBtn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
        }

        #chatSendBtn:hover {
            background: #5568d3;
        }

        #closeChatBtn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }
    </style>
</head>
<body>
<!-- AI Assistant Button -->
<button id="aiAssistantBtn">ðŸ¤– AI Assistant</button>

<!-- Chat Window -->
<div id="chatWindow">
    <div id="chatHeader">
        <span>Form Assistant</span>
        <button id="closeChatBtn">Ã—</button>
    </div>
    <div id="chatMessages">
        <div class="message bot-message">
            Hi! I'm here to help with questions about filling out this form. Try asking me about email requirements, phone format, or any other form-related questions!
        </div>
    </div>
    <div id="chatInputContainer">
        <input type="text" id="chatInput" placeholder="Type your question...">
        <button id="chatSendBtn">Send</button>
    </div>
</div>

<div id="container">
    <main>
        <h2>Feedback</h2>
        <h3>Love something? Hate something? Let us know!</h3>
        Note: Fields marked with an asterisk(*) are mandatory
        <br><br>

        <form id="feedbackForm" novalidate>
            <div class="form-group">
                <label>Title*:</label>
                <input type="radio" name="title" id="miss" value="Miss"/>Miss
                <input type="radio" name="title" id="mr" value="Mr."/>Mr.
                <input type="radio" name="title" id="mrs" value="Mrs."/>Mrs.
                <div class="error-message" id="titleError">Please select a title</div>
            </div>

            <div class="form-group">
                <label for="firstName">First Name*:</label>
                <input type="text" name="firstName" id="firstName" placeholder="First Name"/>
                <div class="error-message" id="firstNameError"></div>
            </div>

            <div class="form-group">
                <label for="lastName">Last Name*:</label>
                <input type="text" name="lastName" id="lastName" placeholder="Last Name"/>
                <div class="error-message" id="lastNameError"></div>
            </div>

            <div class="form-group">
                <label for="emailId">Email Id*:</label>
                <input type="text" name="emailId" id="emailId" placeholder="yourname@northeastern.edu"/>
                <div class="error-message" id="emailIdError"></div>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Phone Number*:</label>
                <input type="text" name="phoneNumber" id="phoneNumber" placeholder="(XXX) XXX-XXXX" maxlength="14"/>
                <div class="error-message" id="phoneNumberError"></div>
            </div>

            <div class="form-group">
                <label for="zipcode">ZipCode*:</label>
                <input type="text" name="zipcode" id="zipcode" placeholder="12345" maxlength="5"/>
                <div class="error-message" id="zipcodeError"></div>
            </div>

            <div class="form-group">
                <label for="address2">Street Address 2:</label>
                <input type="text" name="address2" id="address2" placeholder="Apt, Suite, Unit" maxlength="100"/>
                <div class="char-counter" id="address2Counter">0/100 characters used</div>
            </div>

            <div class="form-group">
                <label for="drinkSelect">Select Drink*:</label>
                <select name="drinkSelect" id="drinkSelect">
                    <option value="">-- Select a drink --</option>
                    <option value="Hot Black Tea - Keemun">Hot Black Tea - Keemun</option>
                    <option value="Iced Green Tea">Iced Green Tea</option>
                    <option value="Coffee - Espresso">Coffee - Espresso</option>
                    <option value="Smoothie - Berry Blast">Smoothie - Berry Blast</option>
                    <option value="Fresh Orange Juice">Fresh Orange Juice</option>
                </select>
                <div class="error-message" id="drinkSelectError">Please select a drink</div>
                <div id="drinkCheckboxContainer" class="dynamic-checkbox-container"></div>
            </div>

            <div class="form-group">
                <label for="source">How did you hear*:</label>
                <input type="checkbox" name="source" value="Facebook" id="sourceFacebook"/> Facebook
                <input type="checkbox" name="source" value="Google" id="sourceGoogle"/> Google
                <input type="checkbox" name="source" value="Yelp" id="sourceYelp"/> Yelp
                <div class="error-message" id="sourceError">Please select at least one option</div>
            </div>

            <div class="form-group">
                <label for="comments">Comments*:</label>
                <textarea name="comments" id="comments" placeholder="Your comments" rows="5" cols="25"></textarea>
                <div class="error-message" id="commentsError"></div>
            </div>

            <div class="form-group">
                <input type="submit" id="submitBtn" value="Submit" disabled>
                <input type="reset" value="Reset">
            </div>
        </form>
    </main>

    <div id="resultsContainer" style="padding: 0 50px 50px 50px;"></div>
</div>

<script>
    // Form validation state
    const validationState = {
        title: false,
        firstName: false,
        lastName: false,
        emailId: false,
        phoneNumber: false,
        zipcode: false,
        drinkSelect: false,
        source: false,
        comments: false
    };

    // Store submitted data
    let submittedData = [];

    // Regex patterns
    const patterns = {
        email: /^[a-zA-Z0-9._%+-]+@northeastern\.edu$/,
        phone: /^\(\d{3}\) \d{3}-\d{4}$/,
        zipcode: /^\d{5}$/,
        alphanumeric: /^[a-zA-Z0-9\s]+$/
    };

    // Initialize form
    document.addEventListener('DOMContentLoaded', function() {
        setupValidation();
        setupChatbot();
    });

    function setupValidation() {
        // Title validation
        const titleRadios = document.querySelectorAll('input[name="title"]');
        titleRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                validateTitle();
            });
        });

        // First Name validation
        const firstName = document.getElementById('firstName');
        firstName.addEventListener('input', function(e) {
            validateAlphanumeric(e.target, 'firstName', 2, 50);
        });

        // Last Name validation
        const lastName = document.getElementById('lastName');
        lastName.addEventListener('input', function(e) {
            validateAlphanumeric(e.target, 'lastName', 2, 50);
        });

        // Email validation
        const emailId = document.getElementById('emailId');
        emailId.addEventListener('input', function(e) {
            validateEmail(e.target);
        });

        // Phone number validation with masking
        const phoneNumber = document.getElementById('phoneNumber');
        phoneNumber.addEventListener('input', function(e) {
            maskPhoneNumber(e.target);
            validatePhone(e.target);
        });

        // Zipcode validation
        const zipcode = document.getElementById('zipcode');
        zipcode.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 5);
            validateZipcode(e.target);
        });

        // Address 2 character counter
        const address2 = document.getElementById('address2');
        address2.addEventListener('input', function(e) {
            updateCharCounter(e.target);
        });

        // Drink select validation with dynamic checkbox
        const drinkSelect = document.getElementById('drinkSelect');
        drinkSelect.addEventListener('change', function(e) {
            validateDrinkSelect(e.target);
            handleDrinkSelection(e.target);
        });

        // Source checkboxes validation
        const sourceCheckboxes = document.querySelectorAll('input[name="source"]');
        sourceCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                validateSource();
            });
        });

        // Comments validation
        const comments = document.getElementById('comments');
        comments.addEventListener('input', function(e) {
            validateComments(e.target);
        });

        // Form submission
        const form = document.getElementById('feedbackForm');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            handleSubmit();
        });

        // Form reset
        form.addEventListener('reset', function() {
            setTimeout(() => {
                resetValidation();
                document.getElementById('drinkCheckboxContainer').innerHTML = '';
                document.getElementById('address2Counter').textContent = '0/100 characters used';
            }, 0);
        });
    }

    function validateTitle() {
        const titleRadios = document.querySelectorAll('input[name="title"]');
        const isValid = Array.from(titleRadios).some(radio => radio.checked);
        const errorElement = document.getElementById('titleError');

        if (!isValid) {
            errorElement.style.display = 'block';
            validationState.title = false;
        } else {
            errorElement.style.display = 'none';
            validationState.title = true;
        }

        updateSubmitButton();
    }

    function validateAlphanumeric(element, fieldName, minLength, maxLength) {
        const value = element.value.trim();
        const errorElement = document.getElementById(fieldName + 'Error');
        let errorMessage = '';

        if (value === '') {
            errorMessage = 'This field is required';
            validationState[fieldName] = false;
        } else if (value.length < minLength) {
            errorMessage = `Minimum ${minLength} characters required`;
            validationState[fieldName] = false;
        } else if (value.length > maxLength) {
            errorMessage = `Maximum ${maxLength} characters allowed`;
            validationState[fieldName] = false;
        } else if (!patterns.alphanumeric.test(value)) {
            errorMessage = 'Only letters, numbers and spaces allowed';
            validationState[fieldName] = false;
        } else {
            validationState[fieldName] = true;
        }

        errorElement.textContent = errorMessage;
        errorElement.style.display = errorMessage ? 'block' : 'none';
        updateSubmitButton();
    }

    function validateEmail(element) {
        const value = element.value.trim();
        const errorElement = document.getElementById('emailIdError');
        let errorMessage = '';

        if (value === '') {
            errorMessage = 'Email is required';
            validationState.emailId = false;
        } else if (!patterns.email.test(value)) {
            errorMessage = 'Email must be @northeastern.edu';
            validationState.emailId = false;
        } else {
            validationState.emailId = true;
        }

        errorElement.textContent = errorMessage;
        errorElement.style.display = errorMessage ? 'block' : 'none';
        updateSubmitButton();
    }

    function maskPhoneNumber(element) {
        let value = element.value.replace(/\D/g, '');

        if (value.length > 0) {
            if (value.length <= 3) {
                value = '(' + value;
            } else if (value.length <= 6) {
                value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
            } else {
                value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
            }
        }

        element.value = value;
    }

    function validatePhone(element) {
        const value = element.value;
        const errorElement = document.getElementById('phoneNumberError');
        let errorMessage = '';

        if (value === '') {
            errorMessage = 'Phone number is required';
            validationState.phoneNumber = false;
        } else if (!patterns.phone.test(value)) {
            errorMessage = 'Format: (XXX) XXX-XXXX';
            validationState.phoneNumber = false;
        } else {
            validationState.phoneNumber = true;
        }

        errorElement.textContent = errorMessage;
        errorElement.style.display = errorMessage ? 'block' : 'none';
        updateSubmitButton();
    }

    function validateZipcode(element) {
        const value = element.value;
        const errorElement = document.getElementById('zipcodeError');
        let errorMessage = '';

        if (value === '') {
            errorMessage = 'Zipcode is required';
            validationState.zipcode = false;
        } else if (!patterns.zipcode.test(value)) {
            errorMessage = 'Zipcode must be 5 digits';
            validationState.zipcode = false;
        } else {
            validationState.zipcode = true;
        }

        errorElement.textContent = errorMessage;
        errorElement.style.display = errorMessage ? 'block' : 'none';
        updateSubmitButton();
    }

    function updateCharCounter(element) {
        const counter = document.getElementById('address2Counter');
        const length = element.value.length;
        const maxLength = element.getAttribute('maxlength');
        counter.textContent = `${length}/${maxLength} characters used`;
    }

    function validateDrinkSelect(element) {
        const value = element.value;
        const errorElement = document.getElementById('drinkSelectError');

        if (value === '') {
            errorElement.style.display = 'block';
            validationState.drinkSelect = false;
        } else {
            errorElement.style.display = 'none';
            validationState.drinkSelect = true;
        }

        updateSubmitButton();
    }

    function handleDrinkSelection(selectElement) {
        const container = document.getElementById('drinkCheckboxContainer');
        const selectedValue = selectElement.value;

        if (selectedValue) {
            container.innerHTML = `
                <label>
                    <input type="checkbox" id="largeDrinkCheckbox" />
                    Large drink (75Â¢ extra)
                </label>
                <div id="largeDrinkTextField" class="dynamic-textfield"></div>
            `;

            const checkbox = document.getElementById('largeDrinkCheckbox');
            checkbox.addEventListener('change', function() {
                handleLargeDrinkCheckbox(this);
            });
        } else {
            container.innerHTML = '';
        }
    }

    function handleLargeDrinkCheckbox(checkbox) {
        const textFieldContainer = document.getElementById('largeDrinkTextField');

        if (checkbox.checked) {
            textFieldContainer.innerHTML = `
                <input type="text" id="largeDrinkText" placeholder="Special instructions for large drink" required style="width: 300px; padding: 5px;" />
                <div class="error-message" id="largeDrinkTextError" style="display: block;">This field is required when checkbox is selected</div>
            `;

            const textField = document.getElementById('largeDrinkText');
            textField.addEventListener('input', function() {
                const errorElement = document.getElementById('largeDrinkTextError');
                if (textField.value.trim() === '') {
                    errorElement.style.display = 'block';
                } else {
                    errorElement.style.display = 'none';
                }
                updateSubmitButton();
            });

            updateSubmitButton();
        } else {
            textFieldContainer.innerHTML = '';
            updateSubmitButton();
        }
    }

    function validateSource() {
        const sourceCheckboxes = document.querySelectorAll('input[name="source"]');
        const isValid = Array.from(sourceCheckboxes).some(checkbox => checkbox.checked);
        const errorElement = document.getElementById('sourceError');

        if (!isValid) {
            errorElement.style.display = 'block';
            validationState.source = false;
        } else {
            errorElement.style.display = 'none';
            validationState.source = true;
        }

        updateSubmitButton();
    }

    function validateComments(element) {
        const value = element.value.trim();
        const errorElement = document.getElementById('commentsError');
        let errorMessage = '';

        if (value === '') {
            errorMessage = 'Comments are required';
            validationState.comments = false;
        } else if (value.length < 10) {
            errorMessage = 'Minimum 10 characters required';
            validationState.comments = false;
        } else if (value.length > 500) {
            errorMessage = 'Maximum 500 characters allowed';
            validationState.comments = false;
        } else {
            validationState.comments = true;
        }

        errorElement.textContent = errorMessage;
        errorElement.style.display = errorMessage ? 'block' : 'none';
        updateSubmitButton();
    }

    function updateSubmitButton() {
        const submitBtn = document.getElementById('submitBtn');
        const allValid = Object.values(validationState).every(value => value === true);

        // Check if large drink checkbox is selected
        const largeDrinkCheckbox = document.getElementById('largeDrinkCheckbox');
        const largeDrinkText = document.getElementById('largeDrinkText');

        if (largeDrinkCheckbox && largeDrinkCheckbox.checked) {
            if (!largeDrinkText || largeDrinkText.value.trim() === '') {
                submitBtn.disabled = true;
                return;
            }
        }

        submitBtn.disabled = !allValid;
    }

    function handleSubmit() {
        const form = document.getElementById('feedbackForm');
        const formData = new FormData(form);

        const data = {
            title: formData.get('title'),
            firstName: formData.get('firstName'),
            lastName: formData.get('lastName'),
            emailId: formData.get('emailId'),
            phoneNumber: formData.get('phoneNumber'),
            zipcode: formData.get('zipcode'),
            address2: formData.get('address2') || '',
            drinkSelect: formData.get('drinkSelect'),
            largeDrink: document.getElementById('largeDrinkCheckbox')?.checked ? 'Yes' : 'No',
            largeDrinkInstructions: document.getElementById('largeDrinkText')?.value || '',
            source: Array.from(document.querySelectorAll('input[name="source"]:checked')).map(cb => cb.value).join(', '),
            comments: formData.get('comments')
        };

        submittedData.push(data);
        displayResults();

        // Clear form
        form.reset();
        document.getElementById('drinkCheckboxContainer').innerHTML = '';
        document.getElementById('address2Counter').textContent = '0/100 characters used';
        resetValidation();
    }

    function displayResults() {
        const container = document.getElementById('resultsContainer');

        let tableHTML = `
            <h3>Submitted Data</h3>
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Zipcode</th>
                        <th>Address 2</th>
                        <th>Drink</th>
                        <th>Large Drink</th>
                        <th>Instructions</th>
                        <th>Source</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
        `;

        submittedData.forEach(data => {
            tableHTML += `
                <tr>
                    <td>${data.title}</td>
                    <td>${data.firstName}</td>
                    <td>${data.lastName}</td>
                    <td>${data.emailId}</td>
                    <td>${data.phoneNumber}</td>
                    <td>${data.zipcode}</td>
                    <td>${data.address2}</td>
                    <td>${data.drinkSelect}</td>
                    <td>${data.largeDrink}</td>
                    <td>${data.largeDrinkInstructions}</td>
                    <td>${data.source}</td>
                    <td>${data.comments}</td>
                </tr>
            `;
        });

        tableHTML += `
                </tbody>
            </table>
        `;

        container.innerHTML = tableHTML;
    }

    function resetValidation() {
        Object.keys(validationState).forEach(key => {
            validationState[key] = false;
        });

        document.querySelectorAll('.error-message').forEach(error => {
            error.style.display = 'none';
        });

        updateSubmitButton();
    }

    // Chatbot functionality
    function setupChatbot() {
        const aiBtn = document.getElementById('aiAssistantBtn');
        const chatWindow = document.getElementById('chatWindow');
        const closeBtn = document.getElementById('closeChatBtn');
        const sendBtn = document.getElementById('chatSendBtn');
        const chatInput = document.getElementById('chatInput');

        aiBtn.addEventListener('click', function() {
            chatWindow.style.display = 'flex';
        });

        closeBtn.addEventListener('click', function() {
            chatWindow.style.display = 'none';
        });

        sendBtn.addEventListener('click', function() {
            sendMessage();
        });

        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    }

    function sendMessage() {
        const input = document.getElementById('chatInput');
        const messagesContainer = document.getElementById('chatMessages');
        const message = input.value.trim();

        if (message === '') return;

        // Display user message
        const userMessageDiv = document.createElement('div');
        userMessageDiv.className = 'message user-message';
        userMessageDiv.textContent = message;
        messagesContainer.appendChild(userMessageDiv);

        // Get bot response
        const botResponse = getBotResponse(message);

        // Display bot message
        setTimeout(() => {
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'message bot-message';
            botMessageDiv.textContent = botResponse;
            messagesContainer.appendChild(botMessageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }, 500);

        input.value = '';
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function getBotResponse(message) {
        const lowerMessage = message.toLowerCase();

        // FAQ responses
        if (lowerMessage.includes('email')) {
            return 'You must use your Northeastern email address ending with @northeastern.edu (example: student@northeastern.edu).';
        }

        if (lowerMessage.includes('phone') || lowerMessage.includes('number')) {
            return 'The phone number must be in the format (XXX) XXX-XXXX. The system will automatically format it as you type.';
        }

        if (lowerMessage.includes('zip') || lowerMessage.includes('zipcode') || lowerMessage.includes('postal')) {
            return 'The zip code must be exactly 5 digits.';
        }

        if (lowerMessage.includes('required') || lowerMessage.includes('mandatory') || lowerMessage.includes('field')) {
            return 'All fields are required except Street Address 2, which is optional. Required fields are marked with an asterisk (*).';
        }

        if (lowerMessage.includes('address') || lowerMessage.includes('street')) {
            return 'Street Address 2 is the only optional field. If left blank, it will remain empty in the results table.';
        }

        if (lowerMessage.includes('submit') || lowerMessage.includes('button') || lowerMessage.includes('disabled')) {
            return 'The submit button will be disabled until all required fields are correctly filled out. Make sure to validate each field as you type.';
        }

        if (lowerMessage.includes('drink')) {
            return 'You must select a drink from the dropdown list. After selecting, you can optionally choose the large size option.';
        }

        if (lowerMessage.includes('comment')) {
            return 'Comments must be between 10 and 500 characters long.';
        }

        if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
            return 'Hello! How can I help you with filling out this form?';
        }

        // Default response
        return "Sorry, I don't know that yet. Please check the form instructions or try asking about email, phone format, zip code, required fields, or address requirements.";
    }
</script>
</body>
</html>
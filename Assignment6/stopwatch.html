<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Stopwatch</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
          font-family: 'Segoe UI', sans-serif;
          background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
          min-height: 100vh;
          color: #fff;
          padding: 30px 16px;
        }
        h1 { text-align: center; font-size: 28px; margin-bottom: 28px; letter-spacing: 2px; }
        .container { max-width: 680px; margin: 0 auto; }
        .card {
          background: rgba(255,255,255,0.07);
          border: 1px solid rgba(255,255,255,0.12);
          border-radius: 16px;
          padding: 32px;
          margin-bottom: 22px;
          backdrop-filter: blur(10px);
        }
        .timer-display {
          font-size: 72px;
          font-family: 'Courier New', monospace;
          text-align: center;
          color: #00d4ff;
          letter-spacing: 6px;
          margin-bottom: 28px;
          text-shadow: 0 0 20px rgba(0,212,255,0.4);
        }
        .event-details { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 22px; }
        .form-group label { display: block; font-size: 12px; font-weight: 600; color: #aaa; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-group input {
          width: 100%;
          padding: 11px 13px;
          border: 2px solid rgba(255,255,255,0.18);
          border-radius: 8px;
          background: rgba(255,255,255,0.07);
          color: #fff;
          font-size: 14px;
          outline: none;
          transition: border-color 0.2s;
        }
        .form-group input::placeholder { color: #666; }
        .form-group input:focus { border-color: #00d4ff; }
        .form-group input.error-border { border-color: #e74c3c; }
        .form-group input:disabled { opacity: 0.4; cursor: not-allowed; }
        .form-group input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        .error-msg { color: #e74c3c; font-size: 12px; margin-top: 5px; display: none; }
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 12px 22px; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; transition: transform 0.1s, opacity 0.2s; letter-spacing: 0.5px; }
        .btn:hover:not(:disabled) { transform: scale(1.04); }
        .btn:disabled { opacity: 0.35; cursor: not-allowed; }
        .btn-start { background: #2ecc71; color: #fff; }
        .btn-pause { background: #f39c12; color: #fff; }
        .btn-stop { background: #e74c3c; color: #fff; }
        .btn-reset { background: #95a5a6; color: #fff; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; flex-wrap: wrap; gap: 10px; }
        .history-header h2 { font-size: 18px; }
        .stats { font-size: 13px; color: #aaa; }
        .stats strong { color: #00d4ff; }
        .filter-row { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
        .filter-row input {
          padding: 9px 12px;
          border: 2px solid rgba(255,255,255,0.18);
          border-radius: 8px;
          background: rgba(255,255,255,0.07);
          color: #fff;
          font-size: 13px;
          outline: none;
        }
        .filter-row input::-webkit-calendar-picker-indicator { filter: invert(1); }
        .btn-filter { padding: 9px 16px; background: #3498db; color: #fff; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; }
        .btn-clear { padding: 9px 14px; background: rgba(255,255,255,0.1); color: #ccc; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; }
        .session-item {
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.08);
          border-radius: 10px;
          padding: 14px 18px;
          margin-bottom: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          gap: 8px;
        }
        .session-info strong { display: block; font-size: 14px; }
        .session-info small { color: #aaa; font-size: 12px; }
        .session-duration { font-family: 'Courier New', monospace; font-size: 18px; font-weight: 700; color: #00d4ff; }
        .empty-msg { text-align: center; color: #555; padding: 28px; font-size: 14px; }
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          background: #2ecc71;
          color: #fff;
          padding: 14px 22px;
          border-radius: 10px;
          font-weight: 600;
          font-size: 14px;
          box-shadow: 0 8px 24px rgba(0,0,0,0.3);
          display: none;
          z-index: 9999;
        }
        @media (max-width: 500px) {
          .event-details { grid-template-columns: 1fr; }
          .timer-display { font-size: 48px; letter-spacing: 3px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>‚è± Event Stopwatch</h1>
    <div class="card">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <div class="event-details">
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="eventDate">
                <div class="error-msg" id="date-error">Please select a date</div>
            </div>
            <div class="form-group">
                <label>Event Name</label>
                <input type="text" id="eventName" placeholder="What are you timing?">
                <div class="error-msg" id="name-error"></div>
            </div>
        </div>
        <div class="controls">
            <button class="btn btn-start" id="startBtn">Start</button>
            <button class="btn btn-pause" id="pauseBtn" disabled>Pause</button>
            <button class="btn btn-stop" id="stopBtn" disabled>Stop & Save</button>
            <button class="btn btn-reset" id="resetBtn">Reset</button>
        </div>
    </div>
    <div class="card">
        <div class="history-header">
            <h2>Session History</h2>
            <div class="stats">Sessions: <strong id="totalSessions">0</strong> &nbsp;|&nbsp; Total: <strong id="totalTime">00:00:00</strong></div>
        </div>
        <div class="filter-row">
            <input type="date" id="filterDate">
            <button class="btn-filter" id="filterBtn">Filter</button>
            <button class="btn-clear" id="clearFilterBtn">Clear</button>
        </div>
        <div id="historyList"></div>
    </div>
</div>
<div class="notification" id="notification"></div>
<script>
    let intervalId = null, totalSeconds = 0, paused = false;

    const pad = n => String(n).padStart(2,'0');
    const formatTime = s => `${pad(Math.floor(s/3600))}:${pad(Math.floor(s%3600/60))}:${pad(s%60)}`;

    $('#eventDate').val(new Date().toISOString().split('T')[0]);

    const startTimer = () => new Promise(resolve => {
      intervalId = setInterval(() => { totalSeconds++; $('#timerDisplay').text(formatTime(totalSeconds)); }, 1000);
      resolve();
    });

    const stopTimer = () => new Promise(resolve => {
      clearInterval(intervalId);
      intervalId = null;
      resolve();
    });

    const validateDate = () => {
      if (!$('#eventDate').val()) { $('#eventDate').addClass('error-border'); $('#date-error').show(); return false; }
      $('#eventDate').removeClass('error-border'); $('#date-error').hide(); return true;
    };

    const validateName = () => {
      const val = $('#eventName').val().trim();
      const err = msg => { $('#eventName').addClass('error-border'); $('#name-error').text(msg).show(); };
      if (!val) { err('Event name is required'); return false; }
      if (val.length < 3) { err('Event name must be at least 3 characters'); return false; }
      if (val.length > 100) { err('Event name too long (max 100 characters)'); return false; }
      if (!/^[a-zA-Z0-9 \-']+$/.test(val)) { err('Event name contains invalid characters'); return false; }
      $('#eventName').removeClass('error-border'); $('#name-error').hide(); return true;
    };

    $('#eventDate').on('focus', () => { $('#eventDate').removeClass('error-border'); $('#date-error').hide(); });
    $('#eventName').on('focus', () => { $('#eventName').removeClass('error-border'); $('#name-error').hide(); });

    $('#startBtn').on('click', async () => {
      if (!validateDate() | !validateName()) return;
      $('#startBtn').prop('disabled', true);
      $('#pauseBtn, #stopBtn').prop('disabled', false);
      $('#eventDate, #eventName').prop('disabled', true);
      await startTimer();
    });

    $('#pauseBtn').on('click', async () => {
      if (!paused) { await stopTimer(); paused = true; $('#pauseBtn').text('Resume'); }
      else { await startTimer(); paused = false; $('#pauseBtn').text('Pause'); }
    });

    $('#stopBtn').on('click', async () => {
      await stopTimer();
      const sessions = getSessions();
      sessions.unshift({ id: Date.now(), date: $('#eventDate').val(), name: $('#eventName').val().trim(), duration: totalSeconds });
      localStorage.setItem('swSessions', JSON.stringify(sessions));
      showNotification('Session saved!');
      resetState();
      renderHistory();
    });

    $('#resetBtn').on('click', async () => { await stopTimer(); resetState(); });

    $('#filterBtn').on('click', () => renderHistory($('#filterDate').val()));
    $('#clearFilterBtn').on('click', () => { $('#filterDate').val(''); renderHistory(); });

    const getSessions = () => { try { return JSON.parse(localStorage.getItem('swSessions')) || []; } catch { return []; } };

    const resetState = () => {
      paused = false; totalSeconds = 0;
      $('#timerDisplay').text('00:00:00');
      $('#startBtn').prop('disabled', false);
      $('#pauseBtn').prop('disabled', true).text('Pause');
      $('#stopBtn').prop('disabled', true);
      $('#eventDate, #eventName').prop('disabled', false);
      $('#eventName').val('');
      $('#eventDate').val(new Date().toISOString().split('T')[0]);
    };

    const renderHistory = (filterDate = '') => {
      let sessions = getSessions();
      if (filterDate) sessions = sessions.filter(s => s.date === filterDate);
      $('#totalSessions').text(sessions.length);
      $('#totalTime').text(formatTime(sessions.reduce((a,s) => a + s.duration, 0)));
      if (!sessions.length) { $('#historyList').html('<div class="empty-msg">No sessions recorded yet</div>'); return; }
      $('#historyList').html(sessions.map(s => `
        <div class="session-item">
          <div class="session-info"><strong>${$('<div>').text(s.name).html()}</strong><small>${s.date}</small></div>
          <div class="session-duration">${formatTime(s.duration)}</div>
        </div>`).join(''));
    };

    const showNotification = msg => {
      $('#notification').text(msg).fadeIn(300);
      setTimeout(() => $('#notification').fadeOut(400), 2500);
    };

    renderHistory();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Stopwatch</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
          font-family: 'Segoe UI', sans-serif;
          background: #f0f2f5;
          min-height: 100vh;
          padding: 30px 16px;
        }
        h1 { text-align: center; color: #333; margin-bottom: 30px; font-size: 26px; }
        .container { max-width: 640px; margin: 0 auto; }
        .card {
          background: #fff;
          border-radius: 8px;
          padding: 32px;
          margin-bottom: 24px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .timer-display {
          font-size: 64px;
          font-family: 'Courier New', monospace;
          text-align: center;
          color: #0f3460;
          margin-bottom: 24px;
          letter-spacing: 4px;
        }
        .event-details { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .form-group label { display: block; font-size: 13px; color: #777; margin-bottom: 4px; font-weight: 600; text-transform: uppercase; }
        .form-group input {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
          outline: none;
        }
        .form-group input:focus { border-color: #0f3460; }
        .form-group input.error-border { border-color: #e74c3c; }
        .form-group input:disabled { background: #f5f5f5; opacity: 0.6; cursor: not-allowed; }
        .error-msg { color: #e74c3c; font-size: 12px; margin-top: 4px; display: none; }
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 11px 20px; border: none; border-radius: 4px; font-size: 14px; font-weight: 700; cursor: pointer; transition: opacity 0.2s; }
        .btn:disabled { opacity: 0.35; cursor: not-allowed; }
        .btn-start { background: #2ecc71; color: #fff; }
        .btn-pause { background: #f39c12; color: #fff; }
        .btn-stop { background: #e74c3c; color: #fff; }
        .btn-reset { background: #95a5a6; color: #fff; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .stats { font-size: 13px; color: #888; }
        .session-item {
          border: 1px solid #eee;
          border-radius: 6px;
          padding: 12px 16px;
          margin-bottom: 8px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        .session-info strong { display: block; font-size: 14px; }
        .session-info small { color: #aaa; font-size: 12px; }
        .session-duration { font-family: 'Courier New', monospace; font-size: 16px; font-weight: 700; color: #0f3460; }
        .empty-msg { text-align: center; color: #bbb; padding: 24px; }
        @media (max-width: 480px) {
          .event-details { grid-template-columns: 1fr; }
          .timer-display { font-size: 48px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Event Stopwatch</h1>
    <div class="card">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <div class="event-details">
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="eventDate">
                <div class="error-msg" id="date-error">Please select a date</div>
            </div>
            <div class="form-group">
                <label>Event Name</label>
                <input type="text" id="eventName" placeholder="What are you timing?">
                <div class="error-msg" id="name-error"></div>
            </div>
        </div>
        <div class="controls">
            <button class="btn btn-start" id="startBtn">Start</button>
            <button class="btn btn-pause" id="pauseBtn" disabled>Pause</button>
            <button class="btn btn-stop" id="stopBtn" disabled>Stop & Save</button>
            <button class="btn btn-reset" id="resetBtn">Reset</button>
        </div>
    </div>
    <div class="card">
        <div class="history-header">
            <h2 style="font-size:18px;color:#333;">Session History</h2>
            <div class="stats">Sessions: <strong id="totalSessions">0</strong> | Total: <strong id="totalTime">00:00:00</strong></div>
        </div>
        <div id="historyList"><div class="empty-msg">No sessions recorded yet</div></div>
    </div>
</div>
<script>
    let intervalId = null;
    let totalSeconds = 0;
    let paused = false;

    const pad = n => String(n).padStart(2,'0');
    const formatTime = s => `${pad(Math.floor(s/3600))}:${pad(Math.floor(s%3600/60))}:${pad(s%60)}`;

    $('#eventDate').val(new Date().toISOString().split('T')[0]);

    const startTimer = () => new Promise(resolve => {
      intervalId = setInterval(() => { totalSeconds++; $('#timerDisplay').text(formatTime(totalSeconds)); }, 1000);
      resolve();
    });

    const stopTimer = () => new Promise(resolve => {
      clearInterval(intervalId);
      intervalId = null;
      resolve();
    });

    const validateDate = () => {
      if (!$('#eventDate').val()) {
        $('#eventDate').addClass('error-border');
        $('#date-error').show();
        return false;
      }
      $('#eventDate').removeClass('error-border');
      $('#date-error').hide();
      return true;
    };

    const validateName = () => {
      const val = $('#eventName').val().trim();
      const showErr = msg => { $('#eventName').addClass('error-border'); $('#name-error').text(msg).show(); };
      if (!val) { showErr('Event name is required'); return false; }
      if (val.length < 3) { showErr('Event name must be at least 3 characters'); return false; }
      if (val.length > 100) { showErr('Event name too long (max 100 characters)'); return false; }
      if (!/^[a-zA-Z0-9 \-']+$/.test(val)) { showErr('Event name contains invalid characters'); return false; }
      $('#eventName').removeClass('error-border');
      $('#name-error').hide();
      return true;
    };

    $('#eventDate').on('focus', () => { $('#eventDate').removeClass('error-border'); $('#date-error').hide(); });
    $('#eventName').on('focus', () => { $('#eventName').removeClass('error-border'); $('#name-error').hide(); });

    $('#startBtn').on('click', async () => {
      if (!validateDate() | !validateName()) return;
      $('#startBtn').prop('disabled', true);
      $('#pauseBtn, #stopBtn').prop('disabled', false);
      $('#eventDate, #eventName').prop('disabled', true);
      await startTimer();
    });

    $('#pauseBtn').on('click', async () => {
      if (!paused) { await stopTimer(); paused = true; $('#pauseBtn').text('Resume'); }
      else { await startTimer(); paused = false; $('#pauseBtn').text('Pause'); }
    });

    $('#stopBtn').on('click', async () => {
      await stopTimer();
      const sessions = JSON.parse(localStorage.getItem('swSessions') || '[]');
      sessions.unshift({ id: Date.now(), date: $('#eventDate').val(), name: $('#eventName').val().trim(), duration: totalSeconds });
      localStorage.setItem('swSessions', JSON.stringify(sessions));
      resetState();
      renderHistory();
    });

    $('#resetBtn').on('click', async () => { await stopTimer(); resetState(); });

    const resetState = () => {
      paused = false; totalSeconds = 0;
      $('#timerDisplay').text('00:00:00');
      $('#startBtn').prop('disabled', false);
      $('#pauseBtn').prop('disabled', true).text('Pause');
      $('#stopBtn').prop('disabled', true);
      $('#eventDate, #eventName').prop('disabled', false);
      $('#eventName').val('');
    };

    const renderHistory = () => {
      const sessions = JSON.parse(localStorage.getItem('swSessions') || '[]');
      $('#totalSessions').text(sessions.length);
      $('#totalTime').text(formatTime(sessions.reduce((a,s) => a + s.duration, 0)));
      if (!sessions.length) { $('#historyList').html('<div class="empty-msg">No sessions recorded yet</div>'); return; }
      $('#historyList').html(sessions.map(s => `
        <div class="session-item">
          <div class="session-info"><strong>${$('<div>').text(s.name).html()}</strong><small>${s.date}</small></div>
          <div class="session-duration">${formatTime(s.duration)}</div>
        </div>`).join(''));
    };

    renderHistory();
</script>
</body>
</html>